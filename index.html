<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sai Vista Ganesh Festival Celebration 2025 - Events Nomination</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- FontAwesome CDN -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #fdecba 0%, #fba931 90%);
      min-height: 100vh;
    }
    .header-gradient {
      background: linear-gradient(90deg, #f7b733 0%, #fc4a1a 100%);
      box-shadow: 0 4px 15px rgba(252, 74, 26, 0.4);
    }
    .event-card {
      background: #fff8f1;
      border: 2px solid #fba931;
      box-shadow: 0 8px 30px rgb(251 146 60 / 0.3);
      transition: box-shadow 0.3s ease;
    }
    .event-card:hover {
      box-shadow: 0 12px 48px rgb(252 74 26 / 0.5);
    }
    .btn-submit {
      background: #fc4a1a;
      background-image: linear-gradient(45deg, #fc4a1a 0%, #f7b733 100%);
      box-shadow: 0 6px 15px rgba(252, 74, 26, 0.6);
      transition: all 0.3s ease;
    }
    .btn-submit:hover {
      background-position: right center;
      box-shadow: 0 10px 20px rgba(252, 74, 26, 0.8);
      transform: translateY(-3px);
    }
    .checkbox-custom:checked + label::before {
      background-color: #f97316; /* orange */
      border-color: #ea580c; /* darker orange */
    }
    .checkbox-custom:focus + label::before {
      box-shadow: 0 0 0 3px #f9731655;
    }
  </style>
</head>
<body class="flex flex-col min-h-screen">

  <!-- Header -->
  <header class="header-gradient text-white py-12 shadow-lg rounded-b-3xl mb-12">
    <div class="container mx-auto px-6 text-center max-w-3xl">
      <i class="fas fa-hands-praying fa-4x mb-4 drop-shadow-lg"></i>
      <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight drop-shadow-md">
        Sai Vista Ganesh Festival Celebration 2025
      </h1>
      <p class="mt-3 text-lg md:text-xl font-semibold drop-shadow-sm text-yellow-200">
        Daily Events Nomination Form: Aug 28 - Sept 5
      </p>
    </div>
  </header>

  <!-- Main Form Container -->
  <main class="flex-grow container mx-auto max-w-lg px-6">
    <section class="event-card rounded-3xl p-10 mb-12">
      <form id="eventsForm" class="space-y-8" novalidate>
        <!-- Name -->
        <div>
          <label for="name" class="block text-orange-700 text-lg font-bold mb-2">
            <i class="fas fa-user mr-2"></i> Full Name <span class="text-red-600">*</span>
          </label>
          <input
            type="text"
            id="name"
            name="name"
            required
            placeholder="Your full name"
            class="w-full border border-orange-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-4 focus:ring-orange-300 placeholder-orange-400"
            autocomplete="name"
          />
        </div>

        <!-- Flat & Wing -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label for="flatNo" class="block text-orange-700 text-lg font-bold mb-2">
              <i class="fas fa-building mr-2"></i> Flat Number <span class="text-red-600">*</span>
            </label>
            <select
              id="flatNo"
              name="flatNo"
              required
              class="w-full border border-orange-300 rounded-lg px-4 py-3 bg-white focus:outline-none focus:ring-4 focus:ring-orange-300"
            >
              <option value="" disabled selected>Select Flat Number</option>
              <!-- Options dynamically injected -->
            </select>
          </div>
          <div>
            <label for="wing" class="block text-orange-700 text-lg font-bold mb-2">
              <i class="fas fa-layer-group mr-2"></i> Wing <span class="text-red-600">*</span>
            </label>
            <select
              id="wing"
              name="wing"
              required
              class="w-full border border-orange-300 rounded-lg px-4 py-3 bg-white focus:outline-none focus:ring-4 focus:ring-orange-300"
            >
              <option value="" disabled selected>Select Wing</option>
              <option value="A">A</option>
              <option value="B">B</option>
              <option value="C">C</option>
              <option value="D">D</option>
              <option value="E">E</option>
              <option value="F">F</option>
            </select>
          </div>
        </div>

        <!-- WhatsApp -->
        <div>
          <label for="whatsapp" class="block text-orange-700 text-lg font-bold mb-2">
            <i class="fab fa-whatsapp mr-2"></i> WhatsApp Number <span class="text-red-600">*</span>
          </label>
          <input
            type="tel"
            id="whatsapp"
            name="whatsapp"
            required
            pattern="[0-9]{10}"
            minlength="10"
            maxlength="10"
            placeholder="10-digit WhatsApp number"
            class="w-full border border-orange-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-4 focus:ring-orange-300"
            autocomplete="tel"
          />
          <p class="text-orange-600 mt-1 text-sm">Enter a 10-digit number without country code</p>
        </div>

        <!-- Events Selection -->
        <fieldset class="space-y-4">
          <legend class="text-orange-800 font-extrabold text-xl mb-3 flex items-center">
            <i class="fas fa-calendar-day mr-3"></i> Select Events to Participate <span class="text-red-600 ml-1">*</span>
          </legend>

          <p id="eventError" class="text-red-600 text-sm mb-2 hidden">Please select at least one event.</p>

          <div class="grid grid-cols-1 gap-3 max-h-56 overflow-y-auto px-3 py-2 border border-orange-200 rounded-lg bg-orange-50 shadow-inner">
            <!-- Events generated here -->
          </div>
        </fieldset>

        <!-- Acknowledge -->
        <div class="flex items-center">
          <input
            type="checkbox"
            id="ack"
            name="ack"
            required
            class="checkbox-custom hidden"
          />
          <label for="ack" class="relative pl-8 cursor-pointer select-none text-orange-700 font-semibold text-base before:absolute before:left-0 before:top-1 before:w-6 before:h-6 before:border-2 before:border-orange-400 before:rounded-md before:bg-white before:transition-colors before:content-['']">
            I acknowledge that my details may be used for event coordination and festival management.
            <span class="text-red-600">*</span>
          </label>
        </div>

        <!-- Submit -->
        <button
          type="submit"
          id="submitButton"
          class="btn-submit w-full text-white font-bold text-xl py-3 rounded-2xl transition-transform flex justify-center items-center hover:scale-105"
          aria-label="Submit Nomination"
        >
          <i class="fas fa-paper-plane mr-3"></i> Submit Nomination
        </button>
      </form>
    </section>

    <!-- Success Message -->
    <section
      id="successMsg"
      class="hidden text-green-900 bg-green-50 border border-green-300 rounded-3xl p-8 text-center font-bold text-xl shadow-md"
      role="alert"
      aria-live="polite"
      aria-atomic="true"
    >
      <i class="fas fa-check-circle text-5xl mb-4 animate-pulse text-green-700"></i>
      <p>Thank you for your nomination!</p>
      <p>We will connect with you soon on WhatsApp.</p>
      <p class="mt-3 text-base font-normal">
        For any changes, please message admin at <strong>8149525915</strong>.
      </p>
    </section>
  </main>

  <footer class="text-center py-6 text-orange-900 font-semibold select-none mt-auto bg-orange-100 shadow-inner rounded-t-3xl">
    <p>Sai Vista Ganesh Festival Celebration 2025 &mdash; Aug 28 to Sept 5</p>
  </footer>

  <script>
    // === Google Apps Script Web App URL (replace this!) ===
    const GOOGLE_SCRIPT_URL = "YOUR_GOOGLE_APPS_SCRIPT_WEBAPP_URL";

    // Populate flat number (1 to 13 floors; flats 01 to 04 each floor)
    const flatSelect = document.getElementById("flatNo");
    for (let floor = 1; floor <= 13; floor++) {
      for (let flat = 1; flat <= 4; flat++) {
        let flatNo = `${floor}${flat < 10 ? "0" + flat : flat}`;
        let opt = document.createElement("option");
        opt.value = flatNo;
        opt.textContent = flatNo;
        flatSelect.appendChild(opt);
      }
    }

    // Event list with day, date, event name
    const events = [
      {id: "event1", day: 1, date: "28 Aug", name: "Modak Making"},
      {id: "event2", day: 2, date: "29 Aug", name: "Drawing Competition"},
      {id: "event3", day: 3, date: "30 Aug", name: "Antakshari"},
      {id: "event4", day: 4, date: "31 Aug", name: "Fancy Dress"},
      {id: "event5", day: 5, date: "1 Sep", name: "Rangoli"},
      {id: "event6", day: 6, date: "2 Sep", name: "Talent Show"},
      {id: "event7", day: 7, date: "3 Sep", name: "Sports"},
      {id: "event8", day: 8, date: "4 Sep", name: "Quiz"},
      {id: "event9", day: 9, date: "5 Sep", name: "Prize Function"},
    ];

    const eventsContainer = document.querySelector("fieldset > div.grid");
    if (eventsContainer) {
      events.forEach(({ id, day, date, name }) => {
        const div = document.createElement("div");
        div.className = "flex items-center";

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.id = id;
        checkbox.name = "events";
        checkbox.value = `Day ${day} - ${date} - ${name}`;
        checkbox.className = "checkbox-custom hidden";
        
        const label = document.createElement("label");
        label.setAttribute("for", id);
        label.textContent = `Day ${day} - ${date} - ${name}`;
        label.className = "relative cursor-pointer select-none pl-8 before:absolute before:left-0 before:top-1 before:w-6 before:h-6 before:border-2 before:border-orange-400 before:rounded-md before:bg-white before:content-[''] before:transition-colors";

        checkbox.addEventListener('change', () => {
          if (checkbox.checked) {
            label.classList.add("font-extrabold", "text-orange-700");
          } else {
            label.classList.remove("font-extrabold", "text-orange-700");
          }
        });

        div.appendChild(checkbox);
        div.appendChild(label);
        eventsContainer.appendChild(div);
      });
    }

    // Allow only digits in WhatsApp, max 10 chars
    const whatsappInput = document.getElementById("whatsapp");
    whatsappInput.addEventListener("input", () => {
      whatsappInput.value = whatsappInput.value.replace(/\D/g, "").slice(0, 10);
    });

    // Form submission logic
    const form = document.getElementById("eventsForm");
    const eventError = document.getElementById("eventError");
    const successMsg = document.getElementById("successMsg");
    const submitBtn = document.getElementById("submitButton");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const selectedEvents = Array.from(document.querySelectorAll('input[name="events"]:checked'));

      // Validate event selection
      if (selectedEvents.length === 0) {
        eventError.classList.remove("hidden");
        selectedEvents[0]?.focus();
        return;
      } else {
        eventError.classList.add("hidden");
      }

      // Validate standard HTML5 constraints
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      // Disable button while submitting
      submitBtn.disabled = true;
      submitBtn.innerHTML = `<i class="fas fa-spinner fa-spin mr-3"></i>Submitting...`;

      // Prepare form data
      const data = {
        name: form.name.value.trim(),
        flatNo: form.flatNo.value,
        wing: form.wing.value,
        whatsapp: form.whatsapp.value,
        events: selectedEvents.map(chk => chk.value).join("; "),
        acknowledge: form.ack.checked ? "Yes" : "No",
        timestamp: new Date().toISOString()
      };

      try {
        const res = await fetch(GOOGLE_SCRIPT_URL, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams(data)
        });

        if(!res.ok){
          throw new Error(`Error: ${res.status}`);
        }
        // Show success & hide form
        form.classList.add("hidden");
        successMsg.classList.remove("hidden");
        successMsg.scrollIntoView({behavior: "smooth"});

      } catch (err) {
        alert("Submission failed. Please try again or contact admin at 8149525915.");
        console.error("Submit error:", err);
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = `<i class="fas fa-paper-plane mr-3"></i> Submit Nomination`;
      }
    });
  </script>
</body>
</html>
